<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Contractor Buddy Demo</title>
    	<meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 
Flex Template 
https://templatemo.com/tm-406-flex
-->
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
        
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/font-awesome.css">
        <link rel="stylesheet" href="css/animate.css">
        <link rel="stylesheet" href="css/templatemo_misc.css">
        <link rel="stylesheet" href="css/templatemo_style.css">     

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->


        <div class="site-main" id="sTop">
            <div class="site-header">
                <div class="container">
                    <div class="row row-eq-height">
                        <div class="col-md-12 text-center">
                            <ul class="social-icons">
                                <li><a href="#" class="fa fa-facebook"></a></li>
                                <li><a href="#" class="fa fa-twitter"></a></li>
                                <li><a href="#" class="fa fa-dribbble"></a></li>
                                <li><a href="#" class="fa fa-linkedin"></a></li>
                            </ul>
                        </div> <!-- /.col-md-12 -->
                    </div> <!-- /.row -->
                </div> <!-- /.container -->
                <div class="main-header">
                    <div class="container">
                        <div id="menu-wrapper">
                            <div class="row">
                                <div class="logo-wrapper col-md-2 col-sm-2">
                                    <h1>
                                        <a href="#">Flex</a>
                                    </h1>
                                </div> <!-- /.logo-wrapper -->
                                <div class="col-md-10 col-sm-10 main-menu text-right">
                                    <div class="toggle-menu visible-sm visible-xs"><i class="fa fa-bars"></i></div>
                                    <ul class="menu-first">
                                        <li class="active"><a href="assets/index.html">Home</a></li>
                                        <li><a href="assets/client.html">Client</a></li>
                                        <li><a href="">Vendor</a></li>                                                                     
                                    </ul>                                    
                                </div> <!-- /.main-menu -->
                            </div> <!-- /.row -->
                        </div> <!-- /#menu-wrapper -->                        
                    </div> <!-- /.container -->
                </div> <!-- /.main-header -->
            </div> <!-- /.site-header -->

            <div class="content-section" id="services">
                    <div class="container">
                        <div class="row">
                            <div class="heading-section col-md-12 text-center">
                                <h2>Vendor Page</h2>
                                <p>Manage your profile, jobs & quotes</p>
                            </div> <!-- /.heading-section -->
                        </div> <!-- /.row -->
                        <div class="row">
                            <div class="col-md-3 col-sm-6">

                                <div class="service-item" id="service-1">
                                    
                                        <div class="member-thumb">
                                                <img src="images/profile.png" alt="">
                                                <div class="team-overlay">
                                                    <h3>{{.Name}}</h3>
                                                    <span>Vendor Profile</span>

                                                    <div class="contact-form">                                                                                       
                                                            <form name="profileform" id="profileform" onsubmit="event.preventDefault();updateFunction(this, event);">
                                                                    <p>
                                                                        <input name="name" type="text" id="name" placeholder="Your Name" value="{{.Name}}">
                                                                    </p>
                                                                    <p>
                                                                        <input name="email" type="text" id="email" placeholder="Your Email" value="{{.Email}}"> 
                                                                    </p>    
                                                                    <p>
                                                                        <select name="vendorCategory" id="vendorCategory">
                                                                            <option value="noselection" selected>no selection</option>
                                                                        </select>
                                                                    </p>
                                                                    <input name="id" type="hidden" value="{{.ID}}"> 
                                                                    <input name="type" type="hidden" value="vendor">                                                                    
                                                                    <input type="submit" class="mainBtn" id="submit" value="Update Profile">
                                                            </form>
                                                    </div> <!-- /.contact-form -->

                                                </div> <!-- /.team-overlay -->
                                        </div> <!-- /.member-thumb -->
                                                                               
                                </div> <!-- /#service-1 -->
                            </div> <!-- /.col-md-3 -->

                            <div class="col-md-3 col-sm-6">
                                <div class="service-item" id="service-3">
                                        <div class="member-thumb">
                                                <!-- <img src="images/profile.png" alt=""> -->
                                                <div class="team-overlay">
                                                    <h3>My Client Quote Request</h3>
                                                    <span>Quote Request</span>

                                                    <ul class="progess-bars" id="vendorQuoteList">                                                         
                                                    </ul>

                                                </div> <!-- /.team-overlay -->
                                        </div> <!-- /.member-thumb -->
                                </div> <!-- /#service-1 -->
                            </div> <!-- /.col-md-3 -->
                            <div class="col-md-3 col-sm-6">
                                <div class="service-item" id="service-4">
                                        <div class="member-thumb">
                                                <!-- <img src="images/profile.png" alt=""> -->
                                                <div class="team-overlay">
                                                    <h3>My Jobs Inbox</h3>
                                                    <span>Jobs</span>

                                                    <ul class="progess-bars" id="vendorJobsQuoteList">                                                                                                                    
                                                    </ul>

                                                </div> <!-- /.team-overlay -->
                                        </div> <!-- /.member-thumb -->
                                </div> <!-- /#service-1 -->
                            </div> <!-- /.col-md-3 -->
                        </div> <!-- /.row -->
                    </div> <!-- /.container -->
                </div> <!-- /#services -->               
            
        <div id="footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 col-xs-12 text-left">
                        <span>Copyright &copy; 2020 Company Name . Design: TemplateMo</span>
                  </div> <!-- /.text-center -->
                    <div class="col-md-4 hidden-xs text-right">
                        <a href="#top" id="go-top">Back to top</a>
                    </div> <!-- /.text-center -->
                </div> <!-- /.row -->
            </div> <!-- /.container -->
        </div> <!-- /#footer -->
        
        <script src="js/vendor/jquery-1.11.0.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
        <script src="js/bootstrap.js"></script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>

        <script src="js/common.js"></script>

        <!-- Axios -->       
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>        
        
        <!-- Google Map Init-->
        <script type="text/javascript">
            (function(){               
                getvendorcategories();

                //show only submitted and pending jobs: TODO - this should probably be done in a query on the backend
                getQuoteRequestByVendorId('{{.ID}}');

                getQuoteRequestByVendorIdAndState('{{.ID}}', "approved");
            })();

            /*
            * Get quotes associated with this client id.
            */
            function getQuoteRequestByVendorId(vendorId){
                $.ajax({
                        url: '/getQuoteRequestByVendorId',
                        type:"GET",	  	 
                        data:{                            
                            "vendorId":vendorId,
                            },
                        success: function(result,status,xhr){
                            if(status.localeCompare("success") == 0){
                                var json = JSON.parse(result);

                                //populate html select element with the data
                                ul = $('#vendorQuoteList');
                                //clear old data first
                                ul.html("");

                                var json = JSON.parse(result);
                                json.forEach(function( quoteRequest, index){
                                    //show only submitted and pending jobs: TODO - this should probably be done in a query on the backend
                                    if(quoteRequest.state === "submitted" || quoteRequest.state === "pending"){

                                        ul.append("<li><div class='progress'> \
                                                <div class='' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100' style='width: 90%;'>" +
                                                    quoteRequest.vendorName + "&nbsp<a onclick=updateQuoteRequest('" +  quoteRequest.id + "','" + 
                                                    escape(quoteRequest.vendorName) + "','" +
                                                    quoteRequest.vendorId + "','" +
                                                    quoteRequest.clientId + "'," +
                                                    "'pending')>" + 
                                                    quoteRequest.state + "</a>" +                                                                                               
                                                    "</div>" +
                                                "</div>" + "<input name='price' type='number' step='.01' id='price_" + quoteRequest.id + "' placeholder='0' value='" + quoteRequest.price + "'>" +
                                                "</li>"); 
                                    }                      
                                });
                            }
                        },
                        error: function(xhr,status,error) {	  		
                            ajaxErrorProcessor(xhr,status,error);
                        }
                    });    
           }     
           
            /*
           * Update the quote request status.
           */
          function updateQuoteRequest(quoteRequestId, vendorName, vendorId, clientId, state){
            var price = $("#price_"+ quoteRequestId).val();

            if(state === "approved"){
                state = "complete";
            }

            $.ajax({
                    url: '/updateQuoteRequest',
                    type:"POST",	  	 
                    data:{
                        "ID":quoteRequestId,
                        "vendorName":unescape(vendorName),
                        "vendorId":vendorId, 
	                    "clientId":clientId,
                        "state":state,
                        "approved":"false",
                        "price":price,                        
                        },
                    success: function(result,status,xhr){
                        if(status.localeCompare("success") == 0){
                            //update clients vendor quote request list
                            getQuoteRequestByVendorId(vendorId);
                            getQuoteRequestByVendorIdAndState(vendorId, "approved");                            
                        }
                    },
                    error: function(xhr,status,error) {	  		
                        ajaxErrorProcessor(xhr,status,error);
                    }
                });             
          }

            /*
            * Get quotes associated with this client id.
            */
            function getQuoteRequestByVendorIdAndState(vendorId, state){
                $.ajax({
                        url: '/getQuoteRequestByVendorIdAndState',
                        type:"GET",	  	 
                        data:{                            
                            "vendorId":vendorId,
                            "state":state,
                            },
                        success: function(result,status,xhr){
                            if(status.localeCompare("success") == 0){
                                var json = JSON.parse(result);

                                //populate html select element with the data
                                ul = $('#vendorJobsQuoteList');
                                //clear old data first
                                ul.html("");

                                var json = JSON.parse(result);
                                json.forEach(function( quoteRequest, index){                     
                                    ul.append("<li><div class='progress'> \
                                            <div class='' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100' style='width: 90%;'>" +
                                                   quoteRequest.vendorName + "&nbsp<a onclick=updateQuoteRequest('" +  quoteRequest.id + "','" + 
                                                   escape(quoteRequest.vendorName) + "','" +
                                                   quoteRequest.vendorId + "','" +
                                                   quoteRequest.clientId + "','" +
                                                   quoteRequest.state + "')>" + 
                                                   quoteRequest.state + "</a>" +                                                                                                
                                                   "</div>" +
                                            "</div>" + "<input name='price' type='number' step='.01' id='price_" + quoteRequest.id + "' placeholder='0' value='" + quoteRequest.price + "'>" +
                                            "</li>");                       
                                });
                            }
                        },
                        error: function(xhr,status,error) {	  		
                            ajaxErrorProcessor(xhr,status,error);
                        }
                    });    
           }               

        </script>
        <!-- templatemo 406 flex -->
    </body>
</html>