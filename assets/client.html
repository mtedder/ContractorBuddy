<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Contractor Buddy Client</title>
    	<meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 
Flex Template 
https://templatemo.com/tm-406-flex
-->
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
        
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/font-awesome.css">
        <link rel="stylesheet" href="css/animate.css">
        <link rel="stylesheet" href="css/templatemo_misc.css">
        <link rel="stylesheet" href="css/templatemo_style.css">     

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->


        <div class="site-main" id="sTop">
            <div class="site-header">
                <div class="container">
                    <div class="row row-eq-height">
                        <div class="col-md-12 text-center">
                            <ul class="social-icons">
                                <li><a href="#" class="fa fa-facebook"></a></li>
                                <li><a href="#" class="fa fa-twitter"></a></li>
                                <li><a href="#" class="fa fa-dribbble"></a></li>
                                <li><a href="#" class="fa fa-linkedin"></a></li>
                            </ul>
                        </div> <!-- /.col-md-12 -->
                    </div> <!-- /.row -->
                </div> <!-- /.container -->
                <div class="main-header">
                    <div class="container">
                        <div id="menu-wrapper">
                            <div class="row">
                                <div class="logo-wrapper col-md-2 col-sm-2">
                                    <h1>
                                        <a href="#">Flex</a>
                                    </h1>
                                </div> <!-- /.logo-wrapper -->
                                <div class="col-md-10 col-sm-10 main-menu text-right">
                                    <div class="toggle-menu visible-sm visible-xs"><i class="fa fa-bars"></i></div>
                                    <ul class="menu-first">
                                        <li class="active"><a href="/assets/index.html">Home</a></li>
                                        <li><a href="">Client</a></li>
                                        <li><a href="assets//vendor.html">Vendor</a></li>                                                                   
                                    </ul>                                    
                                </div> <!-- /.main-menu -->
                            </div> <!-- /.row -->
                        </div> <!-- /#menu-wrapper -->                        
                    </div> <!-- /.container -->
                </div> <!-- /.main-header -->
            </div> <!-- /.site-header -->

            <div class="content-section" id="services">
                    <div class="container">
                        <div class="row">
                            <div class="heading-section col-md-12 text-center">
                                <h2>Client Page</h2>
                                <p>Manage your profile, find Pros & get Quotes</p>
                            </div> <!-- /.heading-section -->
                        </div> <!-- /.row -->
                        <div class="row">
                            <div class="col-md-3 col-sm-6">

                                <div class="service-item" id="service-1">
                                    
                                        <div class="member-thumb">
                                                <img src="images/profile.png" alt="">
                                                <div class="team-overlay">
                                                    <h3>{{.Name}}</h3>
                                                    <span>Client Profile</span>

                                                    <div class="contact-form">                                                                                       
                                                        <form name="profileform" id="profileform" onsubmit="event.preventDefault();updateFunction(this, event);">
                                                            <p>
                                                                <input name="name" type="text" id="name" placeholder="Your Name" value="{{.Name}}">
                                                            </p>
                                                            <p>
                                                                <input name="email" type="text" id="email" placeholder="Your Email" value="{{.Email}}"> 
                                                            </p>    
                                                            <input name="id" type="hidden" value="{{.ID}}"> 
                                                            <input name="type" type="hidden" value="client">                                                                                                
                                                            <input type="submit" class="mainBtn" id="submit" value="Update Profile">
                                                        </form>
                                                    </div> <!-- /.contact-form -->

                                                </div> <!-- /.team-overlay -->
                                        </div> <!-- /.member-thumb -->
                                                                               
                                </div> <!-- /#service-1 -->
                            </div> <!-- /.col-md-3 -->
                            <div class="col-md-3 col-sm-6">
                                <div class="service-item" id="service-2">

                                        <div class="member-thumb">
                                                <!-- <img src="images/profile.png" alt=""> -->
                                                <div class="team-overlay">
                                                    <h3>Find Pros</h3>
                                                    <span>Search</span>
                                                    <div class="contact-form">                                                                                       
                                                            <form method="post" name="contactform" id="contactform">                                                        
                                                                    <!-- <input type="text" placeholder="Search by keyword" aria-label="Search">
                                                                    <i class="fa fa-search" aria-hidden="true"></i> -->
                                                                    <select name="vendorCategory" id="vendorCategory" onchange="listVendorsByCat(this.value);">
                                                                        <option value="noselection" selected>no selection</option>
                                                                    </select>                                                                                                           
                                                            </form>
                                                    </div> <!-- /.contact-form -->

                                                </div> <!-- /.team-overlay -->
                                        </div> <!-- /.member-thumb -->                                                                               

                                </div> <!-- /#service-1 -->
                            </div> <!-- /.col-md-3 -->
                            <div class="col-md-3 col-sm-6">
                                <div class="service-item" id="service-3">
                                        <div class="member-thumb">
                                                <!-- <img src="images/profile.png" alt=""> -->
                                                <div class="team-overlay">
                                                    <h3>My Vendor Search Results</h3>
                                                    <span>Results</span>

                                                    <ul class="progess-bars" id="vendorList">                                                
                                                    </ul>

                                                </div> <!-- /.team-overlay -->
                                        </div> <!-- /.member-thumb -->
                                </div> <!-- /#service-1 -->
                            </div> <!-- /.col-md-3 -->
                            <div class="col-md-3 col-sm-6">
                                <div class="service-item" id="service-4">
                                        <div class="member-thumb">
                                                <!-- <img src="images/profile.png" alt=""> -->
                                                <div class="team-overlay">
                                                    <h3>My Vendor Quote Request</h3>
                                                    <span>Quotes</span>

                                                    <ul class="progess-bars" id="vendorQuoteList">                                                          
                                                    </ul>

                                                </div> <!-- /.team-overlay -->
                                        </div> <!-- /.member-thumb -->
                                </div> <!-- /#service-1 -->
                            </div> <!-- /.col-md-3 -->
                        </div> <!-- /.row -->
                    </div> <!-- /.container -->
                </div> <!-- /#services -->               
            
        <div id="footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 col-xs-12 text-left">
                        <span>Copyright &copy; 2020 Company Name . Design: TemplateMo</span>
                  </div> <!-- /.text-center -->
                    <div class="col-md-4 hidden-xs text-right">
                        <a href="#top" id="go-top">Back to top</a>
                    </div> <!-- /.text-center -->
                </div> <!-- /.row -->
            </div> <!-- /.container -->
        </div> <!-- /#footer -->
        
        <script src="js/vendor/jquery-1.11.0.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
        <script src="js/bootstrap.js"></script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>

        <!-- Axios -->       
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

        <script src="js/common.js"></script>
        
        <!-- Init-->
        <script type="text/javascript">
           (function(){               
                getvendorcategories();
                getQuotesByClientId('{{.ID}}');
           })();          

                              
                //use jquery ajax - axios is sending json to route which is not unmarshalling
                // axios.post('/updateUserProfile', {
                //         "id":formData.get("id"),
                //         "name":formData.get("name"),
                //         "email":formData.get("email"),
                //         "type":formData.get("type"),
                //         "vendorCategory":formData.get("vendorCategory"),                             
                //     })
                //         .then(function (response) {
                //             console.log(response);
                //     })
                //     .catch(function (error) {
                //         console.log(error);
                //     })
                //     .finally(function () {
                //         // always executed
                //     });

    /*
    * List vendors by category.
    */
    function listVendorsByCat(category){
        $.ajax({
            url: '/getvendorbycat',
            type:"GET",	  	 
            data:{                            
                    "vendorCategory":category,                             
                },
            success: function(result,status,xhr){
                if(status.localeCompare("success") == 0){
                    //populate html select element with the data
                    ul = $('#vendorList');
                    //clear old data first
                    ul.html("");

                    var json = JSON.parse(result);
                    //escape troublesome characters in the vendor name
                    json.forEach(function( vendor, index){                     
                        ul.append("<li><div class='progress'> \
                                <div class='' role='progressbar' aria-valuenow='25' aria-valuemin='0' aria-valuemax='100' style='width: 90%;'>" +
                                        vendor.name + "&nbsp<a onclick=createQuote('" + escape(vendor.name) + "','" + vendor.id + "','" + {{.ID}} + "')>Get Quote!</a>" +
                                "</div></div></li>");                       
                    });
                }
            },
            error: function(xhr,status,error) {	  		
                ajaxErrorProcessor(xhr,status,error);
            }
        });
    }             

            /*
            * Add to quote list
            */
            function createQuote(vendorName, vendorId, clientId){
                $.ajax({
                    url: '/createQuoteRequest',
                    type:"POST",	  	 
                    data:{       
                        "vendorName":unescape(vendorName),
                        "vendorId":vendorId, 
	                    "clientId":clientId,
                        "state":"submitted",
                        "approved":"false",
                        "price":0.0,
                        },
                    success: function(result,status,xhr){
                        if(status.localeCompare("success") == 0){
                            //update clients vendor quote request list
                            getQuotesByClientId(clientId);                            
                        }
                    },
                    error: function(xhr,status,error) {	  		
                        ajaxErrorProcessor(xhr,status,error);
                    }
                });                
            }

            /*
            * Get quotes associated with this client id.
            */
           function getQuotesByClientId(clientId){
                $.ajax({
                        url: '/getQuoteRequestByClientId',
                        type:"GET",	  	 
                        data:{                            
                            "clientId":clientId,
                            },
                        success: function(result,status,xhr){
                            if(status.localeCompare("success") == 0){                                   
                                var json = JSON.parse(result);

                                //populate html select element with the data
                                ul = $('#vendorQuoteList');
                                //clear old data first
                                ul.html("");

                                var json = JSON.parse(result);
                                json.forEach(function( quoteRequest, index){           
                                    ul.append("<li><div class='progress'> \
                                            <div class='' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100' style='width: 90%;'>" +
                                                   quoteRequest.vendorName + "&nbsp($" + quoteRequest.price + ")&nbsp<a onclick=updateQuoteRequest('" +  quoteRequest.id + "','" + 
                                                   escape(quoteRequest.vendorName) + "','" +
                                                   quoteRequest.vendorId + "','" +
                                                   quoteRequest.clientId + "','" +
                                                   quoteRequest.state + "')>" + 
                                                   quoteRequest.state + "</a>" +                                                                                               
                                                   "</div>" +
                                            "</div>" + "<input name='price' type='hidden' id='price_" + quoteRequest.id + "' placeholder='0' value='" + quoteRequest.price + "'>" +
                                            "</li>");                       
                                });
                            }
                        },
                        error: function(xhr,status,error) {	  		
                            ajaxErrorProcessor(xhr,status,error);
                        }
                    });    
           }

            /*
           * Update the quote request status.
           */
           function updateQuoteRequest(quoteRequestId, vendorName, vendorId, clientId, state){
            var price = $("#price_"+ quoteRequestId).val();
            if(state === "pending"){
                state = "approved";
            }
            $.ajax({
                    url: '/updateQuoteRequest',
                    type:"POST",	  	 
                    data:{
                        "ID":quoteRequestId,
                        "vendorName":unescape(vendorName),
                        "vendorId":vendorId, 
	                    "clientId":clientId,
                        "state":state,
                        "approved":"false",
                        "price":price,                        
                        },
                    success: function(result,status,xhr){
                        if(status.localeCompare("success") == 0){
                            //update clients vendor quote request list
                            getQuotesByClientId(clientId);  
                        }
                    },
                    error: function(xhr,status,error) {	  		
                        ajaxErrorProcessor(xhr,status,error);
                    }
                });             
          }
        </script>
        <!-- templatemo 406 flex -->
    </body>
</html>